
# RETL - Review ETL Pipeline for Sanvita Products

ETL pipeline –¥–ª—è –∑–±–æ—Ä—É —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –≤—ñ–¥–≥—É–∫—ñ–≤ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ü—ñ—é –°–∞–Ω–≤—ñ—Ç–∞ –∑ —Ä—ñ–∑–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω—ñ–≤ (–Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ makeup.ua, –±—Ä–µ–Ω–¥ naturelle).

–©–æ –≤–∂–µ –ø—Ä–∞—Ü—é—î:
‚úÖ LLM –∞–Ω–∞–ª—ñ–∑ - Xiaomi Mimo model —á–µ—Ä–µ–∑ Openrouter API –¥–ª—è sentiment —Ç–∞ —Å–∫—Ä–∞–ø—ñ–Ω–≥—É
‚úÖ –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è - MD5 hash –¥–ª—è –≤—ñ–¥–≥—É–∫—ñ–≤ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
‚úÖ –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞—Ç - —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –¥–∞—Ç–∏ ("06 —Å–µ—Ä–ø–Ω—è 2022") ‚Üí YYYY-MM-DD
‚úÖ Cleanup - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è - –¥–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏ —É —Ñ–∞–π–ª retl.log (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è)
‚úÖ Power BI ready -  –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è product_core, review_core —á–µ—Ä–µ–∑ MySQL —Å–µ—Ä–≤–µ—Ä

–Ø–∫—ñ —î –ø—Ä–æ–±–ª–µ–º–∏, –Ω–µ–¥–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è:
1. –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –∑–±—ñ—Ä –≤—ñ–¥–≥—É–∫—ñ–≤ —á–µ—Ä–µ–∑ HTTP –∑–∞–ø–∏—Ç–∏ (–∑–∞–π–≤—ñ —Å–∏–º–≤–æ–ª–∏, —ñ–Ω—à–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å). 
–í–∏—Ä—ñ—à–µ–Ω–Ω—è - —Ä–æ–±–∏—Ç–∏ –∑–±—ñ—Ä —á–µ—Ä–µ–∑ playwright —ñ–∑ –ø—ñ–¥–Ω—è—Ç—Ç—è–º –±—Ä–∞—É–∑–µ—Ä–∞
2. –ü—Ä–æ–±–ª–µ–º–∞ –∑ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º sentiment (–≤—Å—é–¥–∏ default "neutral")
–í–∏—Ä—ñ—à–µ–Ω–Ω—è - –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å–µ–Ω—Ç—ñ–º–µ–Ω—Ç—ñ–≤ –Ω–µ–º–æ–∂–ª–∏–≤–µ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –∑–±—ñ—Ä –≤—ñ–¥–≥—É–∫—ñ–≤. –ü—ñ—Å–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –ø—Ä–æ–±–ª–µ–º–∏ –º–∞—î –∑–∞–ø—Ä–∞—Ü—é–≤–∞—Ç–∏
3. –í product_core –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–æ–±–∞–≤–∏—Ç–∏ –ø–æ–ª–µ pc_review_count
–í–∏—Ä—ñ—à–µ–Ω–Ω—è - review_count –≤–∂–µ —É—Å–ø—ñ—à–Ω–æ —Å–∫—Ä–∞–ø–∏—Ç—å—Å—è, –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à –¥–æ–±–∞–≤–ª—è—Ç–∏ –≤ sql
4. –í review_raw i review_core –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–±–∞–≤–∏—Ç–∏ –ø–æ–ª–µ sources (–¥–æ–º–µ–Ω —î-–∫–æ–º–µ—Ä—Å—É)

–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
1. –ß–µ—Ä–µ–∑ —Ç–µ, —â–æ –ª–æ–≥ —Ñ–∞–π–ª —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω, –æ–∫—Ä–µ–º–∞ –ø–∞–ø–∫–∞ –¥–ª—è –Ω—å–æ–≥–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞
2. –í api_keys –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤—Å—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏, —â–æ –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –Ω–∞–∑–≤–æ—é, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ–∞–π–ª–∏ —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ó—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
3. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∂–µ—Ä–µ–ª

## –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –ø—Ä–æ–µ–∫—Ç—É

<img width="1918" height="999" alt="image" src="https://github.com/user-attachments/assets/02b355ac-3905-4fcf-a193-c8bb2e6fb916" />
<img width="1914" height="991" alt="image" src="https://github.com/user-attachments/assets/6cb3b29c-aabb-425d-8ee4-60ddc19ea69b" />

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
retl/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ extract.py      # RAW extraction stage
‚îÇ   ‚îú‚îÄ‚îÄ transform.py    # CORE transformation stage
‚îú‚îÄ‚îÄ powerbi/            # PowerBI —Ä–µ–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ logs/               
‚îÇ   ‚îî‚îÄ‚îÄ retl.log        # –§–∞–π–ª –ª–æ–≥—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ config/             
‚îÇ   ‚îî‚îÄ‚îÄ api_keys.yaml   # –ú—ñ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏
‚îú‚îÄ‚îÄ requirements.txt    # –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
‚îú‚îÄ‚îÄ run_retl.py         # Main pipeline runner
‚îî‚îÄ‚îÄ README.md           # –¶–µ–π —Ñ–∞–π–ª
```

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–≤–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç

```bash
git clone <your-repo>
cd retl
```
–∞–±–æ —á–µ—Ä–µ–∑ github desktop -> vs code

### 2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∞–±–æ
venv\Scripts\activate     # Windows
```

### 3. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
python -m pip install -r requirements.txt
python -m playwright install

```

### 4. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ MySQL

–°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É MySQL —Å–µ—Ä–≤–µ—Ä—ñ (—Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ):

```mysql
CREATE DATABASE retl_database CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 5. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é

–í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ `config/api_keys.yaml`:

```yaml
mysql:
  host: "localhost" # –∞–±–æ —ñ–Ω—à–∏–π —Ö–æ—Å—Ç
  user: "root" # –∞–±–æ —ñ–Ω—à–∞ –Ω–∞–∑–≤–∞ —é–∑–µ—Ä–∞
  password: "–≤–∞—à –ø–∞—Ä–æ–ª—å –¥–æ –±–¥"
  database: "retl_database"
  charset: "utf8mb4"

openrouter:
          api_key: "–≤–∞—à –∫–ª—é—á"
          # –æ—Ç—Ä–∏–º–∞—Ç–∏ –º–æ–∂–Ω–∞ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º: https://openrouter.ai/settings/keys 
          base_url: "https://openrouter.ai/api/v1"
          model: "xiaomi/mimo-v2-flash:free"

sources:
  - name: "makeup.com.ua"
    url: "https://makeup.com.ua/ua/search/?q=naturelle#o[2243][]=1403025"
    domain: "https://makeup.com.ua"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### RAW Tables (data/raw.sql)

**Extracts** - —ñ—Å—Ç–æ—Ä—ñ—è –≤—Å—ñ—Ö –∑–∞–ø—É—Å–∫—ñ–≤
- `extract_id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –∑–∞–ø—É—Å–∫—É
- `extract_fk_source` - –¥–∂–µ—Ä–µ–ª–æ (makeup, epicentr, etc.)
- `extract_datetime` - —á–∞—Å –∑–∞–ø—É—Å–∫—É
- `extract_status` - —Å—Ç–∞—Ç—É—Å: success/failed

**Product_RAW** - —Å–∏—Ä—ñ –¥–∞–Ω—ñ –ø—Ä–æ –ø—Ä–æ–¥—É–∫—Ç–∏
- `pr_id` - ID –ø—Ä–æ–¥—É–∫—Ç—É
- `extract_fk_pr` - –∑–≤'—è–∑–æ–∫ –∑ extract
- `pr_name` - –Ω–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É
- `pr_url_full` - –ø–æ–≤–Ω–∏–π URL

**Review_RAW** - —Å–∏—Ä—ñ –≤—ñ–¥–≥—É–∫–∏
- `rr_id` - ID –≤—ñ–¥–≥—É–∫—É
- `pr_fk_rr` - –∑–≤'—è–∑–æ–∫ –∑ –ø—Ä–æ–¥—É–∫—Ç–æ–º
- `rr_text` - —Ç–µ–∫—Å—Ç –≤—ñ–¥–≥—É–∫—É
- `rr_date` - –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –¥–∞—Ç–∞ (YYYY-MM-DD)
- `rr_hash` - MD5 —Ö–µ—à –¥–ª—è –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—ó

### CORE Tables (production)

**Product_CORE** - —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏
- `pc_id` - ID –ø—Ä–æ–¥—É–∫—Ç—É
- `pc_desc` - –æ–ø–∏—Å

**Review_CORE** - —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –≤—ñ–¥–≥—É–∫–∏ –∑ –∞–Ω–∞–ª—ñ–∑–æ–º
- `rc_id` - ID –≤—ñ–¥–≥—É–∫—É
- `pc_fk_rc` - –∑–≤'—è–∑–æ–∫ –∑ –ø—Ä–æ–¥—É–∫—Ç–æ–º
- `rc_text` - —Ç–µ–∫—Å—Ç
- `rc_source` - –¥–∂–µ—Ä–µ–ª–æ
- `rc_date` - –¥–∞—Ç–∞
- `rc_sentiment` - negative/neutral/positive (–∞–Ω–∞–ª—ñ–∑ LLM)
- `rc_hash` - —Ö–µ—à –¥–ª—è –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—ó

## üîÑ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫

```bash
venv\Scripts\activate 
python run_retl.py


## üéØ –Ø–∫ –ø—Ä–∞—Ü—é—î pipeline

### Stage 1: Extract (RAW)

1. –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å –≤ `Extracts`
2. Parsera —Å–∫—Ä–∞–ø–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø–æ—à—É–∫—É ‚Üí –æ—Ç—Ä–∏–º—É—î —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
3. –ó–±–µ—Ä—ñ–≥–∞—î –≤–∞–ª—ñ–¥–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ `Product_RAW`
4. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É —Å–∫—Ä–∞–ø–∏—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É ‚Üí –æ—Ç—Ä–∏–º—É—î –≤—ñ–¥–≥—É–∫–∏
5. –ù–æ—Ä–º–∞–ª—ñ–∑—É—î –¥–∞—Ç–∏ ("06 —Å–µ—Ä–ø–Ω—è 2022" ‚Üí "2022-08-06")
6. –°—Ç–≤–æ—Ä—é—î MD5 —Ö–µ—à –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–¥–≥—É–∫—É (text + date)
7. –ó–±–µ—Ä—ñ–≥–∞—î –≤ `Review_RAW`
8. –ü—Ä–∏ —É—Å–ø—ñ—Ö—É: status ‚Üí success, –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ: cleanup + status ‚Üí failed

### Stage 2: Transform (CORE)

1. –û—Ç—Ä–∏–º—É—î –≤—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ –∑ —É—Å–ø—ñ—à–Ω–∏—Ö extracts
2. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É:
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ö–æ–∂—ñ—Å—Ç—å –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –ø–æ —Ö–µ—à—É
   - –Ø–∫—â–æ –Ω–æ–≤–∏–π ‚Üí —Å—Ç–≤–æ—Ä—é—î –≤ `Product_CORE`
   - –Ø–∫—â–æ —ñ—Å–Ω—É—î ‚Üí –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ—Å–Ω—É—é—á–∏–π `pc_id`
3. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–¥–≥—É–∫—É:
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ hash (–¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è)
   - LLM –∞–Ω–∞–ª—ñ–∑—É—î sentiment (negative/neutral/positive)
   - –ó–±–µ—Ä—ñ–≥–∞—î –≤ `Review_CORE`

## üõ† –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `logs/retl.log`:

```bash
tail -f logs/retl.log
```

## ‚ö†Ô∏è Troubleshooting

**–ü–æ–º–∏–ª–∫–∞: "No products found"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL –¥–∂–µ—Ä–µ–ª–∞

**–ü–æ–º–∏–ª–∫–∞: "API error"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API key
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª—ñ–º—ñ—Ç–∏ –Ω–∞ –∞–∫–∞—É–Ω—Ç—ñ

**–ü–æ–º–∏–ª–∫–∞: "MySQL connection error"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ credentials –≤ config
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑–∞–ø—É—â–µ–Ω–∏–π MySQL —Å–µ—Ä–≤–µ—Ä

**Cleanup –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ foreign keys –≤ –ë–î
- –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Ä—É—á–Ω—É: —Å–ø–æ—á–∞—Ç–∫—É Review_RAW, –ø–æ—Ç—ñ–º Product_RAW

## üìà Power BI Integration

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ load –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å Power BI –¥–æ production MySQL:

1. Get Data ‚Üí MySQL database
2. Server: `localhost`
3. Database: `retl_database`
4. Import tables: `Product_CORE`, `Review_CORE`

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –º—ñ—Ä–∏:

```dax
Total Reviews = COUNT(Review_CORE[rc_id])

Positive Reviews % = 
    DIVIDE(
        CALCULATE(COUNT(Review_CORE[rc_id]), Review_CORE[rc_sentiment] = "positive"),
        COUNT(Review_CORE[rc_id])
    )

Negative Reviews % = 
    DIVIDE(
        CALCULATE(COUNT(Review_CORE[rc_id]), Review_CORE[rc_sentiment] = "negative"),
        COUNT(Review_CORE[rc_id])
    )

Neutral Reviews % = 
    DIVIDE(
        CALCULATE(COUNT(Review_CORE[rc_id]), Review_CORE[rc_sentiment] = "neutral"),
        COUNT(Review_CORE[rc_id])
    )
```

## üë§ Author

Alia Zmiievska
